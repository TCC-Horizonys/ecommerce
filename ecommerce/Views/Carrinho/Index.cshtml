@model ecommerce.Models.Carrinho

<section class="cart-grid">
    <div>
        <h3 class="cart-title">Carrinho</h3>

        @if (ViewBag.ErrorMessage != null)
        {
            <div class="alert alert-warning alert-dismissible fade show mt-3" role="alert">
                <strong>@ViewBag.ErrorMessage</strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        @*  *@
        @if (Model.Itens == null || !Model.Itens.Any())
        {
            <div class="cart-empty">Seu carrinho está vazio.</div>
        }
        else
        {
            <div class="cart-list">
                @foreach (var item in Model.Itens)
                {
                    <article class="cart-card">
                        <a asp-controller="Loja"
                           asp-action="Detalhes"
                           asp-route-id="@item.Produto.Id"
                           class="thumb-link" aria-label="@item.Produto.Nome">
                            <img class="thumb"
                                 src="@Url.Content("~/img/" + (item.Produto.Imagens?.FirstOrDefault()?.Url ?? "placeholder.png"))"
                                 alt="@item.Produto.Nome" />
                        </a>

                        <a asp-controller="Loja"
                           asp-action="Detalhes"
                           asp-route-id="@item.Produto.Id"
                           class="info-link">
                            <div class="pname">@item.Produto.Nome</div>
                            <div class="pcat">CATEGORIA: @item.Produto.Categoria</div>
                        </a>

                        <div class="pprice">R$ @((item.PrecoUnitario * item.Quantidade).ToString("N2"))</div>

                        <form asp-controller="Carrinho" asp-action="Remover" method="post" class="remove-form">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="produtoId" value="@item.Produto.Id" />
                            <input type="hidden" name="next" value="Infos" />
                            <button type="submit" class="btn-trash" title="Remover">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </article>
                }
            </div>
        }
    </div>

    <aside class="cart-summary">
        <h4 class="summary-title">Pedido</h4>

        <div class="summary-row">
            <span>Total do pedido :</span>
            <strong>R$ @Model.Subtotal.ToString("N2")</strong>
        </div>

        @using Microsoft.AspNetCore.Http
        @{
            var usuarioLogado = Context.Session.GetString("UsuarioNome");
        }

        @if (!string.IsNullOrEmpty(usuarioLogado))
        {
            <form>
                <button type="submit" class="btn-continue" asp-controller="Carrinho" asp-action="Infos">
                    Continuar
                </button>
            </form>
        }
        else
        {
            <div class="auth-actions">
                <a class="btn-continue" asp-controller="Usuario" asp-action="Cadastrar">Cadastrar</a>
                <a class="btn-ghost" asp-controller="Usuario" asp-action="Login">Login</a>
            </div>
        }
    </aside>
</section>

@section Styles{
<style>
:root{
  --bg:#f4efe3;         
  --card:#efe5d6;     
  --ink:#1b1713;        
  --accent:#8b6248;      
  --shadow:0 6px 18px rgba(0,0,0,.08);
  --radius:14px;
  --radius-lg:18px;
  --font-title:"Cinzel","Cormorant Garamond",serif;
}

.cart-grid{ display:grid; gap:20px; grid-template-columns: 1fr 360px; }
media (max-width: 992px){ .cart-grid{ grid-template-columns: 1fr; } }


.cart-title{ font-family:var(--font-title); margin:0 0 10px; letter-spacing:.03em; }
.cart-empty{ background:var(--card); border-radius:var(--radius); padding:18px; color:#6b625a; }

.cart-list{ display:flex; flex-direction:column; gap:26px; }

.cart-card{
  display:grid;
  grid-template-columns: 96px 1fr auto 44px; 
  align-items:center;
  gap:18px;
  background:var(--card);
  border:1px solid rgba(0,0,0,.06);
  border-radius:var(--radius-lg);
  padding:14px 18px;
  box-shadow:var(--shadow);
}

.thumb-link{ display:block; }
.thumb{
  width:96px; height:96px; object-fit:cover;
  background:#fff; border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.06) inset;
}

.info-link{ text-decoration:none; color:inherit; display:block; }
.pname{ font-family:var(--font-title); font-size:1.02rem; line-height:1.2; color:#2c241c; margin-bottom:6px; }
.pcat{ font-size:.78rem; letter-spacing:.02em; color:#6e645b; text-transform:uppercase; }

.pprice{ white-space:nowrap; font-weight:700; color:#2c241c; padding-right:8px; }

.remove-form{ display:flex; justify-content:flex-end; }
.btn-trash{
  width:36px; height:36px; display:grid; place-items:center;
  border:none; background:transparent; color:#3b2d24; font-size:1.2rem; cursor:pointer;
  transition:transform .12s ease, color .12s ease;
}
.btn-trash:hover{ transform:translateY(-1px); color:#8a3b3b; }


.cart-summary{
  background:var(--card);
  border-radius:var(--radius-lg);
  padding:18px;
  box-shadow:var(--shadow);
  height:max-content;
}
.summary-title{ font-family:var(--font-title); margin-bottom:10px; }
.summary-row{
  display:flex; justify-content:space-between; align-items:center;
  padding:10px 0 18px; border-bottom:1px solid rgba(0,0,0,.06); margin-bottom:14px;
}

            .btn-continue, a.btn-continue, .btn-ghost, a.btn-ghost

        {
            display: flex;
            align-items: center; 
            justify-content: center; 
            text-decoration: none !important;
            cursor: pointer;
        }

        .btn-continue,
        a.btn-continue {
            width: 100%;
            border: none;
            background: var(--accent);
            color: #fff !important;
            padding: 10px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 0 rgba(0,0,0,.1) inset;
            text-transform: uppercase;
            letter-spacing: .02em;
        }

            .btn-continue:hover,
            .btn-continue:focus,
            .btn-continue:visited {
                color: #fff !important;
                text-decoration: none !important;
                background: var(--accent); 
                
                transform: translateY(-1px);
            }

        .btn-ghost,
        a.btn-ghost {
            width: 100%;
            border: 1px solid var(--accent);
            background: transparent;
            color: var(--accent) !important;
            padding: 10px 16px;
            border-radius: 12px;
            text-align: center;
        }

            .btn-ghost:hover,
            .btn-ghost:focus,
            .btn-ghost:visited {
                color: var(--accent) !important;
                text-decoration: none !important;
                background: transparent; 

        .auth-actions {
            display: grid;
            gap: 10px;
        }
}
</style>
}
